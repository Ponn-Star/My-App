{
    "sourceFile": "FrontEnd/src/pages/MyBookings.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 13,
            "patches": [
                {
                    "date": 1748623867797,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748623885458,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n import { assets, BookingsData } from '../assets/assets'\r\n \r\n const MyBookings = () => {\r\n \r\n-    const [bookings, setBookings] = useState(userBookingsDummyData)\r\n+    const [bookings, setBookings] = useState(BookingsData)\r\n \r\n   return (\r\n     <div className='py-28 md:pb-35 md:pt-32 px-4 md:px-16 lg:px-24 xl:px-32'>\r\n       <Title title='My Bookings' subTitle='Easily manage your past, current, and upcoming hotel reservations in one place. Plan your trips seamlessly with just a few clicks' align='left'/>\r\n"
                },
                {
                    "date": 1748886574433,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,8 +5,10 @@\n const MyBookings = () => {\r\n \r\n     const [bookings, setBookings] = useState(BookingsData)\r\n \r\n+    const handlePayment = async\r\n+\r\n   return (\r\n     <div className='py-28 md:pb-35 md:pt-32 px-4 md:px-16 lg:px-24 xl:px-32'>\r\n       <Title title='My Bookings' subTitle='Easily manage your past, current, and upcoming hotel reservations in one place. Plan your trips seamlessly with just a few clicks' align='left'/>\r\n \r\n"
                },
                {
                    "date": 1748886620021,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,10 +5,16 @@\n const MyBookings = () => {\r\n \r\n     const [bookings, setBookings] = useState(BookingsData)\r\n \r\n-    const handlePayment = async\r\n+    const handlePayment = async (bookingId)=>{\r\n+        try {\r\n \r\n+        } catch (error){\r\n+            \r\n+        }\r\n+    }\r\n+\r\n   return (\r\n     <div className='py-28 md:pb-35 md:pt-32 px-4 md:px-16 lg:px-24 xl:px-32'>\r\n       <Title title='My Bookings' subTitle='Easily manage your past, current, and upcoming hotel reservations in one place. Plan your trips seamlessly with just a few clicks' align='left'/>\r\n \r\n"
                },
                {
                    "date": 1748886714046,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,18 @@\n import React, { useState } from 'react'\r\n import Title from '../components/Title'\r\n import { assets, BookingsData } from '../assets/assets'\r\n+import axios from 'axios'\r\n \r\n const MyBookings = () => {\r\n \r\n     const [bookings, setBookings] = useState(BookingsData)\r\n \r\n     const handlePayment = async (bookingId)=>{\r\n         try {\r\n+            const { data } = await axios.post('/api/bookings/stripe-payment', {bookingId}, {headers: { Authorization: `Bearer ${await getToken()}` }})\r\n+        } catch (error){\r\n \r\n-        } catch (error){\r\n-            \r\n         }\r\n     }\r\n \r\n   return (\r\n"
                },
                {
                    "date": 1748886767152,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,16 +1,22 @@\n import React, { useState } from 'react'\r\n import Title from '../components/Title'\r\n import { assets, BookingsData } from '../assets/assets'\r\n import axios from 'axios'\r\n+import toast from 'react-hot-toast'\r\n \r\n const MyBookings = () => {\r\n \r\n     const [bookings, setBookings] = useState(BookingsData)\r\n \r\n     const handlePayment = async (bookingId)=>{\r\n         try {\r\n             const { data } = await axios.post('/api/bookings/stripe-payment', {bookingId}, {headers: { Authorization: `Bearer ${await getToken()}` }})\r\n+            if (data.success) {\r\n+                window.location.href = data.url\r\n+            } else{\r\n+                toast.error\r\n+            }\r\n         } catch (error){\r\n \r\n         }\r\n     }\r\n"
                },
                {
                    "date": 1748886791467,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,12 +13,12 @@\n             const { data } = await axios.post('/api/bookings/stripe-payment', {bookingId}, {headers: { Authorization: `Bearer ${await getToken()}` }})\r\n             if (data.success) {\r\n                 window.location.href = data.url\r\n             } else{\r\n-                toast.error\r\n+                toast.error(data.message)\r\n             }\r\n         } catch (error){\r\n-\r\n+            toast.error(error)\r\n         }\r\n     }\r\n \r\n   return (\r\n"
                },
                {
                    "date": 1748886798438,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,9 +16,9 @@\n             } else{\r\n                 toast.error(data.message)\r\n             }\r\n         } catch (error){\r\n-            toast.error(error)\r\n+            toast.error(error.message)\r\n         }\r\n     }\r\n \r\n   return (\r\n"
                },
                {
                    "date": 1748886842547,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -75,9 +75,9 @@\n                         {booking.isPaid ? \"Paid\" : \"Unpaid\"}\r\n                         </p>\r\n                     </div>\r\n                     {!booking.isPaid && (\r\n-                        <button className='px-4 py-1.5 mt-4 text-xs border border-gray-400 rounded-full hover:bg-gray-50 transition-all cursor-pointer'>\r\n+                        <button onClick={()=> handlePayment(booking._id)} className='px-4 py-1.5 mt-4 text-xs border border-gray-400 rounded-full hover:bg-gray-50 transition-all cursor-pointer'>\r\n                         Pay Now\r\n                         </button>\r\n                     )}\r\n                 </div>\r\n"
                },
                {
                    "date": 1749144174597,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,91 +1,109 @@\n-import React, { useState } from 'react'\r\n+import React, { useState, useEffect } from 'react'\r\n import Title from '../components/Title'\r\n-import { assets, BookingsData } from '../assets/assets'\r\n+import { assets } from '../assets/assets'\r\n import axios from 'axios'\r\n import toast from 'react-hot-toast'\r\n+import { useAppContext } from '../conext/AppContext'\r\n \r\n const MyBookings = () => {\r\n+    const { getToken } = useAppContext();\r\n+    const [bookings, setBookings] = useState([]);\r\n \r\n-    const [bookings, setBookings] = useState(BookingsData)\r\n+    useEffect(() => {\r\n+        const fetchBookings = async () => {\r\n+            try {\r\n+                const { data } = await axios.get('/api/bookings/user', {\r\n+                    headers: { Authorization: `Bearer ${await getToken()}` }\r\n+                });\r\n+                if (data.success) {\r\n+                    setBookings(data.bookings);\r\n+                } else {\r\n+                    toast.error(data.message);\r\n+                }\r\n+            } catch (error) {\r\n+                toast.error(error.message);\r\n+            }\r\n+        };\r\n+        fetchBookings();\r\n+    }, [getToken]);\r\n \r\n-    const handlePayment = async (bookingId)=>{\r\n+    const handlePayment = async (bookingId) => {\r\n         try {\r\n-            const { data } = await axios.post('/api/bookings/stripe-payment', {bookingId}, {headers: { Authorization: `Bearer ${await getToken()}` }})\r\n+            const { data } = await axios.post('/api/bookings/stripe-payment', { bookingId }, {\r\n+                headers: { Authorization: `Bearer ${await getToken()}` }\r\n+            });\r\n             if (data.success) {\r\n-                window.location.href = data.url\r\n-            } else{\r\n-                toast.error(data.message)\r\n+                window.location.href = data.url;\r\n+            } else {\r\n+                toast.error(data.message);\r\n             }\r\n-        } catch (error){\r\n-            toast.error(error.message)\r\n+        } catch (error) {\r\n+            toast.error(error.message);\r\n         }\r\n-    }\r\n+    };\r\n \r\n-  return (\r\n-    <div className='py-28 md:pb-35 md:pt-32 px-4 md:px-16 lg:px-24 xl:px-32'>\r\n-      <Title title='My Bookings' subTitle='Easily manage your past, current, and upcoming hotel reservations in one place. Plan your trips seamlessly with just a few clicks' align='left'/>\r\n+    return (\r\n+        <div className='py-28 md:pb-35 md:pt-32 px-4 md:px-16 lg:px-24 xl:px-32'>\r\n+            <Title title='My Bookings' subTitle='Easily manage your past, current, and upcoming hotel reservations in one place. Plan your trips seamlessly with just a few clicks' align='left' />\r\n \r\n-      <div className='max-w-6xl mt-8 w-full text-gray-800'>\r\n-        <div className='hidden md:grid md:grid-cols-[3fr_2fr_1fr] w-full border-b border-gray-300 font-medium text-base py-3'>\r\n-            <div className='w-1/3'>Glamping</div>\r\n-            <div className='w-1/3'>Date & Timings</div>\r\n-            <div className='w-1/3'>Payment</div>\r\n-        </div>\r\n+            <div className='max-w-6xl mt-8 w-full text-gray-800'>\r\n+                <div className='hidden md:grid md:grid-cols-[3fr_2fr_1fr] w-full border-b border-gray-300 font-medium text-base py-3'>\r\n+                    <div className='w-1/3'>Glamping</div>\r\n+                    <div className='w-1/3'>Date & Timings</div>\r\n+                    <div className='w-1/3'>Payment</div>\r\n+                </div>\r\n \r\n-        {bookings.map((booking) => (\r\n-            <div key={booking._id} className='grid grid-cols-1 md:grid-cols-[3fr_2fr_1fr] w-full border-b border-gray-300 py-6 first:border-t'>\r\n-                {/* Hotel & Room */}\r\n-                <div className='flex flex-col md:flex-row'>\r\n-                    <img src={booking.room.images[0]} alt=\"hotel-img\" className='min-md:w-44 rounded shadow object-cover'/>\r\n-                    <div className='flex flex-col gap-1.5 max-md:mt-3 min-md:ml-4'>\r\n-                        <p className='font-playfair text-2xl'>{booking.hotel.name}\r\n-                            <span className='font-inter text-sm'>({booking.room.roomType})</span>\r\n-                        </p>\r\n-                        <div className='flex items-center gap-1 text-sm text-gray-500'>\r\n-                            <img src={assets.locationIcon} alt=\"location-icon\"/>\r\n-                            <span>{booking.hotel.address}</span>\r\n+                {bookings.map((booking) => (\r\n+                    <div key={booking._id} className='grid grid-cols-1 md:grid-cols-[3fr_2fr_1fr] w-full border-b border-gray-300 py-6 first:border-t'>\r\n+                        {/* Room Info */}\r\n+                        <div className='flex flex-col md:flex-row'>\r\n+                            <img src={booking.room?.images?.[0]} alt=\"room-img\" className='min-md:w-44 rounded shadow object-cover' />\r\n+                            <div className='flex flex-col gap-1.5 max-md:mt-3 min-md:ml-4'>\r\n+                                <p className='font-playfair text-2xl'>\r\n+                                    {booking.room?.roomType}\r\n+                                </p>\r\n+                                <div className='flex items-center gap-1 text-sm text-gray-500'>\r\n+                                    <img src={assets.guestsIcon} alt=\"guests-icon\" />\r\n+                                    <span>Guests: {booking.soKhach}</span>\r\n+                                </div>\r\n+                                <p className='text-base'>Total: {booking.tongTien}.000 VND</p>\r\n+                                <p className='text-sm text-gray-500'>Status: {booking.trangThai}</p>\r\n+                            </div>\r\n                         </div>\r\n-                        <div className='flex items-center gap-1 text-sm text-gray-500'>\r\n-                            <img src={assets.guestsIcon} alt=\"guests-icon\"/>\r\n-                            <span>Guests: {booking.guests}</span>\r\n+                        {/* Date & Timings */}\r\n+                        <div className='flex flex-row md:items-center md:gap-12 mt-3 gap-8'>\r\n+                            <div>\r\n+                                <p>Check-In:</p>\r\n+                                <p className='text-gray-500 text-sm'>\r\n+                                    {new Date(booking.checkInDate).toLocaleDateString()}\r\n+                                </p>\r\n+                            </div>\r\n+                            <div>\r\n+                                <p>Check-Out:</p>\r\n+                                <p className='text-gray-500 text-sm'>\r\n+                                    {new Date(booking.checkOutDate).toLocaleDateString()}\r\n+                                </p>\r\n+                            </div>\r\n                         </div>\r\n-                        <p className='text-base'>Total: ${booking.totalPrice}</p>\r\n+                        {/* Payment */}\r\n+                        <div className='flex flex-col items-start justify-center pt-3'>\r\n+                            <div className='flex items-center gap-2'>\r\n+                                <div className={`h-3 w-3 rounded-full ${booking.daThanhToan ? \"bg-green-500\" : \"bg-red-500\"}`}></div>\r\n+                                <p className={`text-sm ${booking.daThanhToan ? \"text-green-500\" : \"text-red-500\"}`}>\r\n+                                    {booking.daThanhToan ? \"Paid\" : \"Unpaid\"}\r\n+                                </p>\r\n+                            </div>\r\n+                            {!booking.daThanhToan && (\r\n+                                <button onClick={() => handlePayment(booking._id)} className='px-4 py-1.5 mt-4 text-xs border border-gray-400 rounded-full hover:bg-gray-50 transition-all cursor-pointer'>\r\n+                                    Pay Now\r\n+                                </button>\r\n+                            )}\r\n+                        </div>\r\n                     </div>\r\n-                </div>\r\n-                {/* Data & Timings */}\r\n-                <div className='flex flex-row md:items-center md:gap-12 mt-3 gap-8'>\r\n-                <div>\r\n-                    <p>Check-In:</p>\r\n-                    <p className='text-gray-500 text-sm'>\r\n-                    {new Date(booking.checkInDate).toDateString()}\r\n-                    </p>\r\n-                </div>\r\n-                <div>\r\n-                    <p>Check-Out:</p>\r\n-                    <p className='text-gray-500 text-sm'>\r\n-                    {new Date(booking.checkOutDate).toDateString()}\r\n-                    </p>\r\n-                </div>\r\n-                </div>\r\n-                {/* payment */}\r\n-                <div className='flex flex-col items-start justify-center pt-3'>\r\n-                    <div className='flex items-center gap-2'>\r\n-                        <div className={`h-3 w-3 rounded-full ${booking.isPaid ? \"bg-green-500\" : \"bg-red-500\"}`}></div>\r\n-                        <p className={`text-sm ${booking.isPaid ? \"text-green-500\" : \"text-red-500\"}`}>\r\n-                        {booking.isPaid ? \"Paid\" : \"Unpaid\"}\r\n-                        </p>\r\n-                    </div>\r\n-                    {!booking.isPaid && (\r\n-                        <button onClick={()=> handlePayment(booking._id)} className='px-4 py-1.5 mt-4 text-xs border border-gray-400 rounded-full hover:bg-gray-50 transition-all cursor-pointer'>\r\n-                        Pay Now\r\n-                        </button>\r\n-                    )}\r\n-                </div>\r\n+                ))}\r\n             </div>\r\n-        ))}\r\n-      </div>\r\n-    </div>\r\n-  )\r\n+        </div>\r\n+    )\r\n }\r\n \r\n export default MyBookings\r\n"
                },
                {
                    "date": 1749161877094,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -56,9 +56,13 @@\n                 {bookings.map((booking) => (\r\n                     <div key={booking._id} className='grid grid-cols-1 md:grid-cols-[3fr_2fr_1fr] w-full border-b border-gray-300 py-6 first:border-t'>\r\n                         {/* Room Info */}\r\n                         <div className='flex flex-col md:flex-row'>\r\n-                            <img src={booking.room?.images?.[0]} alt=\"room-img\" className='min-md:w-44 rounded shadow object-cover' />\r\n+                            <img\r\n+                              src={assets[booking.room?.images?.[0]] || booking.room?.images?.[0] || assets.uploadArea}\r\n+                              alt=\"room-img\"\r\n+                              className='min-md:w-44 rounded shadow object-cover'\r\n+                            />\r\n                             <div className='flex flex-col gap-1.5 max-md:mt-3 min-md:ml-4'>\r\n                                 <p className='font-playfair text-2xl'>\r\n                                     {booking.room?.roomType}\r\n                                 </p>\r\n"
                },
                {
                    "date": 1749161958152,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,11 +10,17 @@\n     const [bookings, setBookings] = useState([]);\r\n \r\n     useEffect(() => {\r\n         const fetchBookings = async () => {\r\n+            const token = await getToken();\r\n+            if (!token) {\r\n+                toast.error(\"Bạn cần đăng nhập để xem đặt phòng!\");\r\n+                // navigate('/sign-in'); // nếu muốn chuyển hướng\r\n+                return;\r\n+            }\r\n             try {\r\n                 const { data } = await axios.get('/api/bookings/user', {\r\n-                    headers: { Authorization: `Bearer ${await getToken()}` }\r\n+                    headers: { Authorization: `Bearer ${token}` }\r\n                 });\r\n                 if (data.success) {\r\n                     setBookings(data.bookings);\r\n                 } else {\r\n"
                },
                {
                    "date": 1749187433815,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,9 +49,9 @@\n     };\r\n \r\n     return (\r\n         <div className='py-28 md:pb-35 md:pt-32 px-4 md:px-16 lg:px-24 xl:px-32'>\r\n-            <Title title='My Bookings' subTitle='Easily manage your past, current, and upcoming hotel reservations in one place. Plan your trips seamlessly with just a few clicks' align='left' />\r\n+            <Title title='Lịch sử đặt phòng' subTitle='Easily manage your past, current, and upcoming hotel reservations in one place. Plan your trips seamlessly with just a few clicks' align='left' />\r\n \r\n             <div className='max-w-6xl mt-8 w-full text-gray-800'>\r\n                 <div className='hidden md:grid md:grid-cols-[3fr_2fr_1fr] w-full border-b border-gray-300 font-medium text-base py-3'>\r\n                     <div className='w-1/3'>Glamping</div>\r\n"
                },
                {
                    "date": 1749187495248,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,9 +49,9 @@\n     };\r\n \r\n     return (\r\n         <div className='py-28 md:pb-35 md:pt-32 px-4 md:px-16 lg:px-24 xl:px-32'>\r\n-            <Title title='Lịch sử đặt phòng' subTitle='Easily manage your past, current, and upcoming hotel reservations in one place. Plan your trips seamlessly with just a few clicks' align='left' />\r\n+            <Title title='Lịch sử đặt phòng' subTitle='Quản lý mọi đặt phòng khách sạn của bạn – quá khứ, hiện tại và tương lai – thật dễ dàng chỉ trong một nơi. Lên kế hoạch du lịch nhanh chóng, tiện lợi trong vài bước đơn giản.' align='left' />\r\n \r\n             <div className='max-w-6xl mt-8 w-full text-gray-800'>\r\n                 <div className='hidden md:grid md:grid-cols-[3fr_2fr_1fr] w-full border-b border-gray-300 font-medium text-base py-3'>\r\n                     <div className='w-1/3'>Glamping</div>\r\n"
                }
            ],
            "date": 1748623867797,
            "name": "Commit-0",
            "content": "import React, { useState } from 'react'\r\nimport Title from '../components/Title'\r\nimport { assets, BookingsData } from '../assets/assets'\r\n\r\nconst MyBookings = () => {\r\n\r\n    const [bookings, setBookings] = useState(userBookingsDummyData)\r\n\r\n  return (\r\n    <div className='py-28 md:pb-35 md:pt-32 px-4 md:px-16 lg:px-24 xl:px-32'>\r\n      <Title title='My Bookings' subTitle='Easily manage your past, current, and upcoming hotel reservations in one place. Plan your trips seamlessly with just a few clicks' align='left'/>\r\n\r\n      <div className='max-w-6xl mt-8 w-full text-gray-800'>\r\n        <div className='hidden md:grid md:grid-cols-[3fr_2fr_1fr] w-full border-b border-gray-300 font-medium text-base py-3'>\r\n            <div className='w-1/3'>Glamping</div>\r\n            <div className='w-1/3'>Date & Timings</div>\r\n            <div className='w-1/3'>Payment</div>\r\n        </div>\r\n\r\n        {bookings.map((booking) => (\r\n            <div key={booking._id} className='grid grid-cols-1 md:grid-cols-[3fr_2fr_1fr] w-full border-b border-gray-300 py-6 first:border-t'>\r\n                {/* Hotel & Room */}\r\n                <div className='flex flex-col md:flex-row'>\r\n                    <img src={booking.room.images[0]} alt=\"hotel-img\" className='min-md:w-44 rounded shadow object-cover'/>\r\n                    <div className='flex flex-col gap-1.5 max-md:mt-3 min-md:ml-4'>\r\n                        <p className='font-playfair text-2xl'>{booking.hotel.name}\r\n                            <span className='font-inter text-sm'>({booking.room.roomType})</span>\r\n                        </p>\r\n                        <div className='flex items-center gap-1 text-sm text-gray-500'>\r\n                            <img src={assets.locationIcon} alt=\"location-icon\"/>\r\n                            <span>{booking.hotel.address}</span>\r\n                        </div>\r\n                        <div className='flex items-center gap-1 text-sm text-gray-500'>\r\n                            <img src={assets.guestsIcon} alt=\"guests-icon\"/>\r\n                            <span>Guests: {booking.guests}</span>\r\n                        </div>\r\n                        <p className='text-base'>Total: ${booking.totalPrice}</p>\r\n                    </div>\r\n                </div>\r\n                {/* Data & Timings */}\r\n                <div className='flex flex-row md:items-center md:gap-12 mt-3 gap-8'>\r\n                <div>\r\n                    <p>Check-In:</p>\r\n                    <p className='text-gray-500 text-sm'>\r\n                    {new Date(booking.checkInDate).toDateString()}\r\n                    </p>\r\n                </div>\r\n                <div>\r\n                    <p>Check-Out:</p>\r\n                    <p className='text-gray-500 text-sm'>\r\n                    {new Date(booking.checkOutDate).toDateString()}\r\n                    </p>\r\n                </div>\r\n                </div>\r\n                {/* payment */}\r\n                <div className='flex flex-col items-start justify-center pt-3'>\r\n                    <div className='flex items-center gap-2'>\r\n                        <div className={`h-3 w-3 rounded-full ${booking.isPaid ? \"bg-green-500\" : \"bg-red-500\"}`}></div>\r\n                        <p className={`text-sm ${booking.isPaid ? \"text-green-500\" : \"text-red-500\"}`}>\r\n                        {booking.isPaid ? \"Paid\" : \"Unpaid\"}\r\n                        </p>\r\n                    </div>\r\n                    {!booking.isPaid && (\r\n                        <button className='px-4 py-1.5 mt-4 text-xs border border-gray-400 rounded-full hover:bg-gray-50 transition-all cursor-pointer'>\r\n                        Pay Now\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MyBookings\r\n"
        }
    ]
}